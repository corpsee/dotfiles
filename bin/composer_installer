#!/usr/bin/env bash

echo "COMPOSER INSTALLER";
echo "******************";
echo "";

DESTINATION="/usr/local/bin/composer";
INSTALLED_VERSION="$(${DESTINATION} --version 2> /dev/null | grep -o -m 1 -P 'Composer version .*? ' | sed -n -r 's/Composer version (.*?) /\1/p')";
if [[ "$INSTALLED_VERSION" == "" ]]; then
    INSTALLED_VERSION="0.0.0 (not installed)";
fi;

echo "Installed version: $INSTALLED_VERSION";

VERSION="$(curl --silent https://api.github.com/repos/composer/composer/releases/latest | jq .name -r)";

echo "Latest version: $VERSION";
echo "";

if [[ "$VERSION" == "$INSTALLED_VERSION" ]]; then
    echo "Latest version ($VERSION) already installed.";
    exit 0;
fi;

echo "Downloading latest version ($VERSION)...";
echo "";

sudo curl -L "https://getcomposer.org/download/$VERSION/composer.phar" -o "$DESTINATION";
sudo chmod +x "$DESTINATION";

echo "";
echo "Latest version ($VERSION) has been  installed."

exit 1;
